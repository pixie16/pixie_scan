<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Pixie16 Analysis Software Suite: adding and using an optional detector processor</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">Pixie16 Analysis Software</a>&nbsp;&raquo&nbsp;<a class="el" href="devman.html">Developer Manual (under construction)</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="addopt">adding and using an optional detector processor </a></h1><h2><a class="anchor" id="addopt-intro">
Introduction</a></h2>
<p>We discuss here the steps one needs to follow in order to add and use an experiment specific detector processor. These types of Processors work in conjunction with their parent processors to provide additional functionality beyond the original processor's intent.</p>
<p>For example, the use of the <a class="el" href="d3/dd9/classVandleAtLeribssProcessor.html" title="Class to process VANDLE related events.">VandleAtLeribssProcessor</a> is designed to add additional histograms, gates, and other features that need not be used in the original <a class="el" href="de/d92/classVandleProcessor.html" title="Class to process VANDLE related events.">VandleProcessor</a>. These processors may also be used to provide completely new functionality, while still being part of an existing processor.</p>
<p>Not every processor is ready to be used in this way and may require some modifications in order to obtain this functionality. For examples of how to update your processors to use this feature take a look at the <a class="el" href="d1/d90/classGeProcessor.html" title="Processor to handle Ge (read as clover) events.">GeProcessor</a> and the <a class="el" href="de/d92/classVandleProcessor.html" title="Class to process VANDLE related events.">VandleProcessor</a>.</p>
<h2><a class="anchor" id="addopt-get">
Getting the Optional Processors</a></h2>
<p>The optional processors are kept in an additional git repository, since they will not all necessarily be useful to everybody who uses this software. They can be downloaded using the following command : </p>
<div class="fragment"><pre class="fragment">    git clone https:<span class="comment">//github.com/pixie16/ExperimentProcessors.git</span>
</pre></div><h2><a class="anchor" id="addopt-setup">
Setting up the Environment</a></h2>
<p>To take advantage and ease the use of these new processors, you should export an additional environmental variable in your .bashrc. </p>
<div class="fragment"><pre class="fragment">    export EXTRA_PROCESSORS=/absolute/path/to/extra/processors
</pre></div><p> By exporting this variable, the Makefile will automatically search the directory for the desired files.</p>
<h2><a class="anchor" id="addopt-make">
Setup the Makefile</a></h2>
<p>Unfortunately, we still need to add the processor to the Makefile so that it will be compiled and linked with the program. You should add your processor to the list of existing processors. </p>
<div class="fragment"><pre class="fragment">    VANDLEATLERIBSSPROCESSORO = <a class="code" href="d3/dd9/classVandleAtLeribssProcessor.html" title="Class to process VANDLE related events.">VandleAtLeribssProcessor</a>.$(ObjSuf)
</pre></div><p> Second, you need to add the new processor to the list of CXX_OBJS </p>
<div class="fragment"><pre class="fragment">    $(VANDLEATLERIBSSPROCESSORO)
</pre></div><p> You can either add it in its own line or with the other processors, it really doesn't matter.</p>
<h2><a class="anchor" id="addopt-driv">
Setup DetectorDriver</a></h2>
<p>We now need to update the processor list in <a class="el" href="d4/d4a/classDetectorDriver.html" title="DetectorDriver controls event processing.">DetectorDriver</a>. Since we are inheriting from the <a class="el" href="de/d92/classVandleProcessor.html" title="Class to process VANDLE related events.">VandleProcessor</a>, we will change the entry for the <a class="el" href="de/d92/classVandleProcessor.html" title="Class to process VANDLE related events.">VandleProcessor</a> directly. The code that originally looked like this </p>
<div class="fragment"><pre class="fragment">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;VandleProcessor&quot;</span>) {
            <span class="keywordtype">double</span> res = processor.attribute(<span class="stringliteral">&quot;res&quot;</span>).as_double(2.0);
            <span class="keywordtype">double</span> offset = processor.attribute(<span class="stringliteral">&quot;offset&quot;</span>).as_double(200.0);
            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numStarts = processor.attribute(<span class="stringliteral">&quot;NumStarts&quot;</span>).as_int(2);
            vector&lt;string&gt; types =
                <a class="code" href="df/dcb/namespacestrings.html#a9bdb2686dd6d86c7879f87868e3e6026">strings::tokenize</a>(processor.attribute(<span class="stringliteral">&quot;types&quot;</span>).as_string(),<span class="stringliteral">&quot;,&quot;</span>);
            vecProcess.push_back(<span class="keyword">new</span> <a class="code" href="de/d92/classVandleProcessor.html" title="Class to process VANDLE related events.">VandleProcessor</a>(types, res, offset, numStarts));
        }
</pre></div><p> Will now look like </p>
<div class="fragment"><pre class="fragment">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;VandleProcessor&quot;</span> || name == <span class="stringliteral">&quot;VandleAtLeribssProcessor&quot;</span>) {
            <span class="keywordtype">double</span> res = processor.attribute(<span class="stringliteral">&quot;res&quot;</span>).as_double(2.0);
            <span class="keywordtype">double</span> offset = processor.attribute(<span class="stringliteral">&quot;offset&quot;</span>).as_double(200.0);
            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numStarts = processor.attribute(<span class="stringliteral">&quot;NumStarts&quot;</span>).as_int(2);
            vector&lt;string&gt; types =
                <a class="code" href="df/dcb/namespacestrings.html#a9bdb2686dd6d86c7879f87868e3e6026">strings::tokenize</a>(processor.attribute(<span class="stringliteral">&quot;types&quot;</span>).as_string(),<span class="stringliteral">&quot;,&quot;</span>);
            <span class="keywordflow">if</span>(name == <span class="stringliteral">&quot;VandleProcessor&quot;</span>)
                vecProcess.push_back(<span class="keyword">new</span> <a class="code" href="de/d92/classVandleProcessor.html" title="Class to process VANDLE related events.">VandleProcessor</a>(types, res, offset, numStarts));
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;VandleAtLeribssProcessor&quot;</span>)
                vecProcess.push_back(<span class="keyword">new</span> <a class="code" href="d3/dd9/classVandleAtLeribssProcessor.html" title="Class to process VANDLE related events.">VandleAtLeribssProcessor</a>(types, res, offset, numStarts));
        }
</pre></div><p> In addition, we need to add the header file to the list at the top of <a class="el" href="d4/d4a/classDetectorDriver.html" title="DetectorDriver controls event processing.">DetectorDriver</a>. </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">        #include &quot;<a class="code" href="d9/d38/VandleAtLeribssProcessor_8hpp.html" title="A class to process data from the LeRIBSS 2012 campaign.">VandleAtLeribssProcessor.hpp</a>&quot;</span>
</pre></div> <h2><a class="anchor" id="addopt-cfg">
Setup the Configuration File</a></h2>
<p>Finally, we need to update the Config.xml to use the new processor instead of the stock one. </p>
<div class="fragment"><pre class="fragment">        &lt;Processor name=<span class="stringliteral">&quot;VandleAtLeribssProcessor&quot;</span>
            types=<span class="stringliteral">&quot;small&quot;</span> res=<span class="stringliteral">&quot;2&quot;</span> offset=<span class="stringliteral">&quot;200&quot;</span> numStarts=<span class="stringliteral">&quot;2&quot;</span>/&gt;
</pre></div><p> This code will replace the line for the <a class="el" href="de/d92/classVandleProcessor.html" title="Class to process VANDLE related events.">VandleProcessor</a> in the <a class="el" href="d4/d4a/classDetectorDriver.html" title="DetectorDriver controls event processing.">DetectorDriver</a> node.</p>
<h2><a class="anchor" id="addopt-tips">
Tips and Tricks</a></h2>
<p>One thing to keep in mind is that the constructor for the child processor must accept at a minimum the same number of arguments that the parent does. This does not mean that you are limited in any way for a maximum.</p>
<p>In this example we could have added an additional argument to the constructor for the <a class="el" href="d3/dd9/classVandleAtLeribssProcessor.html" title="Class to process VANDLE related events.">VandleAtLeribssProcessor</a> for the number of the banana that we would like to analyze. This argument would not need to be passed to the constructor for the parent. </p>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 4 Jun 2016 for Pixie16 Analysis Software Suite by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
