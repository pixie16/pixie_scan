<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Pixie16 Analysis Software Suite: adding a New Detector Processor</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="main.html">Pixie16 Analysis Software</a>&nbsp;&raquo&nbsp;<a class="el" href="devman.html">Developer Manual (under construction)</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="add">adding a New Detector Processor </a></h1><p>This page will describe the process for adding a new Processor to the analysis. In principle, you can add a Processor to handle specific detector types, or to handle those that already exist.</p>
<p>To add a new detector first a class must be constructed which defines its behavior by creating a .hpp and .cpp file. For example, the following section defines a new detector class called "Template".</p>
<p>The hpp file should look something like </p>
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#ifndef __TEMPLATEPROCESSOR_HPP__</span>
<span class="preprocessor"></span><span class="preprocessor">#define __TEMPLATEPROCESSOR_HPP__</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &quot;<a class="code" href="d7/d81/EventProcessor_8hpp.html" title="Generic event processor.">EventProcessor.hpp</a>&quot;</span>

<span class="keyword">class </span><a class="code" href="d4/d92/classTemplateProcessor.html" title="A generic processor to be used as a template for others.">TemplateProcessor</a> : <span class="keyword">public</span> <a class="code" href="d2/d58/classEventProcessor.html" title="Class to handle event processing.">EventProcessor</a> {
<span class="keyword">public</span>:
    <a class="code" href="d4/d92/classTemplateProcessor.html#aa17271683f7099ab58dbfa09c891d3b7">TemplateProcessor</a>();
    <a class="code" href="d4/d92/classTemplateProcessor.html#aa17271683f7099ab58dbfa09c891d3b7">TemplateProcessor</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp; a);
    <a class="code" href="d4/d92/classTemplateProcessor.html#a93cedd7c190470f8fb23bcd6b62689ae">~TemplateProcessor</a>(){};
    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="d4/d92/classTemplateProcessor.html#a742ab756482dffb14190e61de691d520">DeclarePlots</a>(<span class="keywordtype">void</span>);
    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="d4/d92/classTemplateProcessor.html#a2961282ba4e4d5e118499cc7168cced1">PreProcess</a>(<a class="code" href="de/d77/classRawEvent.html" title="The all important raw event.">RawEvent</a> &amp;event);
    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="d4/d92/classTemplateProcessor.html#a2957f5cb5e642a57968d47890ecee57d">Process</a>(<a class="code" href="de/d77/classRawEvent.html" title="The all important raw event.">RawEvent</a> &amp;event);
    std::vector&lt;ChanEvent*&gt; <a class="code" href="d4/d92/classTemplateProcessor.html#a9bda253d7f66907a6250ccae109047e2">GetTemplateEvents</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{
        <span class="keywordflow">return</span>(<a class="code" href="d4/d92/classTemplateProcessor.html#a055eaf21070eee189c9b435a3d89cebf" title="vector of events for people to get">evts_</a>);
    }
<span class="keyword">private</span>:
    <span class="keywordtype">double</span> <a class="code" href="d4/d92/classTemplateProcessor.html#ace0d47e0efc07227216ffa0dc421a264" title="a variable global to the class">a_</a>; 
    std::vector&lt;ChanEvent*&gt; <a class="code" href="d4/d92/classTemplateProcessor.html#a055eaf21070eee189c9b435a3d89cebf" title="vector of events for people to get">evts_</a>; 
};
<span class="preprocessor">#endif // __TEMPLATEPROCESSOR_HPP__</span>
</pre></div><p>The cpp file should look something like </p>
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#include &lt;iostream&gt;</span>

<span class="preprocessor">#include &quot;<a class="code" href="df/dd7/DammPlotIds_8hpp.html" title="Lists Offsets and Ranges for various Processors.">DammPlotIds.hpp</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="d5/d64/Globals_8hpp.html" title="constant parameters used in pixie16 analysis">Globals.hpp</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="d7/d4b/RawEvent_8hpp.html" title="Header file for the rawevent.">RawEvent.hpp</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="dc/deb/TemplateProcessor_8hpp.html" title="A Template class to be used to build others.">TemplateProcessor.hpp</a>&quot;</span>

<span class="keyword">namespace </span>dammIds {
    <span class="keyword">namespace </span>dettemplate {
        <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="de/dcd/namespacedammIds_1_1ge.html#a6a5d3ab083c3f428ddd1148bdd15d4e5" title="Energy.">D_ENERGY</a>  = 0; 
        <span class="keyword">const</span> <span class="keywordtype">int</span> DD_TEMPLATE_VS_PULSER = 1; 
    }
}<span class="comment">//namespace dammIds</span>

<span class="keyword">using namespace </span>std;
<span class="keyword">using namespace </span>dammIds::dettemplate;

<a class="code" href="d4/d92/classTemplateProcessor.html#aa17271683f7099ab58dbfa09c891d3b7">TemplateProcessor::TemplateProcessor</a>():
    <a class="code" href="d2/d58/classEventProcessor.html" title="Class to handle event processing.">EventProcessor</a>(<a class="code" href="d8/dd3/namespacedammIds_1_1raw.html#a0af3314d10f1af8ee7e09ad22635ca10" title="offset for raw histograms">OFFSET</a>, <a class="code" href="d8/dd3/namespacedammIds_1_1raw.html#a464ff94b3296abf6c08ea705b0919049" title="Range for raw histograms.">RANGE</a>, <span class="stringliteral">&quot;TemplateProcessor&quot;</span>) {
    associatedTypes.insert(<span class="stringliteral">&quot;template&quot;</span>);
}

<a class="code" href="d4/d92/classTemplateProcessor.html#aa17271683f7099ab58dbfa09c891d3b7">TemplateProcessor::TemplateProcessor</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;a):
    <a class="code" href="d2/d58/classEventProcessor.html" title="Class to handle event processing.">EventProcessor</a>(<a class="code" href="d8/dd3/namespacedammIds_1_1raw.html#a0af3314d10f1af8ee7e09ad22635ca10" title="offset for raw histograms">OFFSET</a>, <a class="code" href="d8/dd3/namespacedammIds_1_1raw.html#a464ff94b3296abf6c08ea705b0919049" title="Range for raw histograms.">RANGE</a>, <span class="stringliteral">&quot;TemplateProcessor&quot;</span>) {
    associatedTypes.insert(<span class="stringliteral">&quot;template&quot;</span>);
    a_ = a;
}

<span class="keywordtype">void</span> <a class="code" href="d4/d92/classTemplateProcessor.html#a742ab756482dffb14190e61de691d520">TemplateProcessor::DeclarePlots</a>(<span class="keywordtype">void</span>) {
    <a class="code" href="d2/d58/classEventProcessor.html#aac0d7f24194df48f204ebb9c9b75e19d" title="Declares a 1D histogram calls the C++ wrapper for DAMM.">DeclareHistogram1D</a>(<a class="code" href="de/dcd/namespacedammIds_1_1ge.html#a6a5d3ab083c3f428ddd1148bdd15d4e5" title="Energy.">D_ENERGY</a>, <a class="code" href="df/dd7/DammPlotIds_8hpp.html#ae32bacd5d1cf53f3095e01cd00ab43f3">SA</a>, <span class="stringliteral">&quot;Energy&quot;</span>);
    <a class="code" href="d2/d58/classEventProcessor.html#a37b6d5ad90cc6e55c8021682a355764a" title="Declares a 2D histogram calls the C++ wrapper for DAMM.">DeclareHistogram2D</a>(DD_TEMPLATE_VS_PULSER, <a class="code" href="df/dd7/DammPlotIds_8hpp.html#ae32bacd5d1cf53f3095e01cd00ab43f3">SA</a>, <a class="code" href="df/dd7/DammPlotIds_8hpp.html#ae32bacd5d1cf53f3095e01cd00ab43f3">SA</a>,
                       <span class="stringliteral">&quot;Template Energy vs. Pulser Energy&quot;</span>);
}

<span class="keywordtype">bool</span> <a class="code" href="d4/d92/classTemplateProcessor.html#a2961282ba4e4d5e118499cc7168cced1">TemplateProcessor::PreProcess</a>(<a class="code" href="de/d77/classRawEvent.html" title="The all important raw event.">RawEvent</a> &amp;event) {
    <span class="keywordflow">if</span> (!<a class="code" href="d2/d58/classEventProcessor.html#aaf3ee14dc80b9d91ace360a3fd06d81b">EventProcessor::PreProcess</a>(event))
        <span class="keywordflow">return</span>(<span class="keyword">false</span>);

    <a class="code" href="d4/d92/classTemplateProcessor.html#a055eaf21070eee189c9b435a3d89cebf" title="vector of events for people to get">evts_</a> = <span class="keyword">event</span>.GetSummary(<span class="stringliteral">&quot;template&quot;</span>)-&gt;GetList();

    <span class="keywordflow">for</span>(vector&lt;ChanEvent*&gt;::const_iterator it = <a class="code" href="d4/d92/classTemplateProcessor.html#a055eaf21070eee189c9b435a3d89cebf" title="vector of events for people to get">evts_</a>.begin();
        it != <a class="code" href="d4/d92/classTemplateProcessor.html#a055eaf21070eee189c9b435a3d89cebf" title="vector of events for people to get">evts_</a>.end(); it++) {
        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> location = (*it)-&gt;GetChanID().GetLocation();
        <span class="keywordflow">if</span>(location == 0)
            <a class="code" href="d2/d58/classEventProcessor.html#ad5201bb392726e409ba2a6ac44e764d8" title="Implementation of the plot command to interface with the DAMM routines.">plot</a>(<a class="code" href="de/dcd/namespacedammIds_1_1ge.html#a6a5d3ab083c3f428ddd1148bdd15d4e5" title="Energy.">D_ENERGY</a>, (*it)-&gt;GetEnergy()*<a class="code" href="d4/d92/classTemplateProcessor.html#ace0d47e0efc07227216ffa0dc421a264" title="a variable global to the class">a_</a>);
    }
    <span class="keywordflow">return</span>(<span class="keyword">true</span>);
}

<span class="keywordtype">bool</span> <a class="code" href="d4/d92/classTemplateProcessor.html#a2957f5cb5e642a57968d47890ecee57d">TemplateProcessor::Process</a>(<a class="code" href="de/d77/classRawEvent.html" title="The all important raw event.">RawEvent</a> &amp;event) {
    <span class="keywordflow">if</span> (!<a class="code" href="d2/d58/classEventProcessor.html#aca58c43da052f54d2952fa849c447f1c">EventProcessor::Process</a>(event))
        <span class="keywordflow">return</span>(<span class="keyword">false</span>);

    <span class="keyword">static</span> <span class="keyword">const</span> vector&lt;ChanEvent*&gt; &amp; pulserEvents =
        <span class="keyword">event</span>.GetSummary(<span class="stringliteral">&quot;pulser&quot;</span>)-&gt;GetList();

    <span class="keywordflow">for</span>(vector&lt;ChanEvent*&gt;::const_iterator it = <a class="code" href="d4/d92/classTemplateProcessor.html#a055eaf21070eee189c9b435a3d89cebf" title="vector of events for people to get">evts_</a>.begin();
        it != <a class="code" href="d4/d92/classTemplateProcessor.html#a055eaf21070eee189c9b435a3d89cebf" title="vector of events for people to get">evts_</a>.end(); it++) {
        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> loc = (*it)-&gt;GetChanID().GetLocation();
        <span class="keywordflow">for</span>(vector&lt;ChanEvent*&gt;::const_iterator itA = pulserEvents.begin();
            itA != pulserEvents.end(); itA++) {
            <span class="keywordflow">if</span>(loc == 0)
                <a class="code" href="d2/d58/classEventProcessor.html#ad5201bb392726e409ba2a6ac44e764d8" title="Implementation of the plot command to interface with the DAMM routines.">plot</a>(DD_TEMPLATE_VS_PULSER, (*it)-&gt;GetEnergy(),
                     (*itA)-&gt;GetEnergy());
        }
    }
    <span class="keywordflow">return</span>(<span class="keyword">true</span>);
}
</pre></div><p>Once a class exists for your new detector you must create an instance of it in the <a class="el" href="d4/d4a/classDetectorDriver.html" title="DetectorDriver controls event processing.">DetectorDriver</a>. Include the proper file in DetectorDriver.cpp </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #include &quot;<a class="code" href="dc/deb/TemplateProcessor_8hpp.html" title="A Template class to be used to build others.">TemplateProcessor.hpp</a>&quot;</span>
</pre></div><p> Be sure that you put the proper detector type into the "associated types" vector in the constructor. This will ensure that whenever this detector type is in the event the processor will be called.</p>
<p>Next initialize it with the other processors in the constructor of <a class="el" href="d4/d4a/classDetectorDriver.html" title="DetectorDriver controls event processing.">DetectorDriver</a>. </p>
<div class="fragment"><pre class="fragment">    ...
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;TemplateProcessor&quot;</span>) {
            vecProcess.push_back(<span class="keyword">new</span> <a class="code" href="d4/d92/classTemplateProcessor.html" title="A generic processor to be used as a template for others.">TemplateProcessor</a>());
    }
    ...
</pre></div><p>Finally, your new processor simply needs to be added to the Config.xml and you are ready to do your analysis.</p>
<p>Adding a new detector type needs only minimal additional changes to the <a class="el" href="d1/dfd/classDetectorLibrary.html" title="A class to define a library of detectors known to the analysis.">DetectorLibrary</a>. To the list of known detectors </p>
<div class="fragment"><pre class="fragment">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> detTypes = 2;
    <span class="keyword">const</span> <span class="keywordtype">string</span> detectorStrings[detTypes] = {
        <span class="stringliteral">&quot;3hen&quot;</span>, <span class="stringliteral">&quot;beta_scint&quot;</span>, <span class="stringliteral">&quot;dssd_front&quot;</span>, <span class="stringliteral">&quot;dssd_back&quot;</span>, <span class="stringliteral">&quot;ge&quot;</span>, <span class="stringliteral">&quot;generic&quot;</span>,
        <span class="stringliteral">&quot;idssd_front&quot;</span>, <span class="stringliteral">&quot;ignore&quot;</span>, <span class="stringliteral">&quot;ion_chamber&quot;</span>, <span class="stringliteral">&quot;liquid_scint&quot;</span>, <span class="stringliteral">&quot;logic&quot;</span>,
        <span class="stringliteral">&quot;mcp&quot;</span>, <span class="stringliteral">&quot;mtc&quot;</span>, <span class="stringliteral">&quot;neutron_scint&quot;</span>, <span class="stringliteral">&quot;position&quot;</span>, <span class="stringliteral">&quot;pulser&quot;</span>, <span class="stringliteral">&quot;si&quot;</span>, <span class="stringliteral">&quot;ssd&quot;</span>,
        <span class="stringliteral">&quot;timeclass&quot;</span>, <span class="stringliteral">&quot;tvandle&quot;</span>, <span class="stringliteral">&quot;vandle&quot;</span>, <span class="stringliteral">&quot;template&quot;</span>
    };
</pre></div> </div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 4 Jun 2016 for Pixie16 Analysis Software Suite by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
