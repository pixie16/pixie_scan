<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Pixie16 Analysis Software Suite: adding a New Detector Processor</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Pixie16 Analysis Software Suite
   </div>
   <div id="projectbrief">Analysis code for processing of .ldf files</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('add.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">adding a New Detector Processor </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page will describe the process for adding a new Processor to the analysis. In principle, you can add a Processor to handle specific detector types, or to handle those that already exist.</p>
<p>To add a new detector first a class must be constructed which defines its behavior by creating a .hpp and .cpp file. For example, the following section defines a new detector class called "Template".</p>
<p>The hpp file should look something like </p><div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#ifndef __TEMPLATEPROCESSOR_HPP__</span></div><div class="line"><span class="preprocessor">#define __TEMPLATEPROCESSOR_HPP__</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="d7/d81/EventProcessor_8hpp.html">EventProcessor.hpp</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span><a class="code" href="d4/d92/classTemplateProcessor.html">TemplateProcessor</a> : <span class="keyword">public</span> <a class="code" href="d2/d58/classEventProcessor.html">EventProcessor</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <a class="code" href="d4/d92/classTemplateProcessor.html#aa17271683f7099ab58dbfa09c891d3b7">TemplateProcessor</a>();</div><div class="line">    <a class="code" href="d4/d92/classTemplateProcessor.html#aa17271683f7099ab58dbfa09c891d3b7">TemplateProcessor</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp; a);</div><div class="line">    <a class="code" href="d4/d92/classTemplateProcessor.html#a93cedd7c190470f8fb23bcd6b62689ae">~TemplateProcessor</a>(){};</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="d4/d92/classTemplateProcessor.html#ae447375c9e3eae31685252bf17e526ad">DeclarePlots</a>(<span class="keywordtype">void</span>);</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="d4/d92/classTemplateProcessor.html#a554450b2ad914835e6b1b8d13a31b409">PreProcess</a>(<a class="code" href="de/d77/classRawEvent.html">RawEvent</a> &amp;event);</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="d4/d92/classTemplateProcessor.html#a75039958a15712e6d1f83b3654ce6e88">Process</a>(<a class="code" href="de/d77/classRawEvent.html">RawEvent</a> &amp;event);</div><div class="line">    std::vector&lt;ChanEvent*&gt; <a class="code" href="d4/d92/classTemplateProcessor.html#a9bda253d7f66907a6250ccae109047e2">GetTemplateEvents</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{</div><div class="line">        <span class="keywordflow">return</span>(<a class="code" href="d4/d92/classTemplateProcessor.html#a055eaf21070eee189c9b435a3d89cebf">evts_</a>);</div><div class="line">    }</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keywordtype">double</span> <a class="code" href="d4/d92/classTemplateProcessor.html#ace0d47e0efc07227216ffa0dc421a264">a_</a>; </div><div class="line">    std::vector&lt;ChanEvent*&gt; <a class="code" href="d4/d92/classTemplateProcessor.html#a055eaf21070eee189c9b435a3d89cebf">evts_</a>; </div><div class="line">};</div><div class="line"><span class="preprocessor">#endif // __TEMPLATEPROCESSOR_HPP__</span></div></div><!-- fragment --><p>The cpp file should look something like </p><div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="df/dd7/DammPlotIds_8hpp.html">DammPlotIds.hpp</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="d5/d64/Globals_8hpp.html">Globals.hpp</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="d7/d4b/RawEvent_8hpp.html">RawEvent.hpp</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="dc/deb/TemplateProcessor_8hpp.html">TemplateProcessor.hpp</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span><a class="code" href="d3/d8a/namespacedammIds.html">dammIds</a> {</div><div class="line">    <span class="keyword">namespace </span>dettemplate {</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="d0/dc0/namespacedammIds_1_1dettemplate.html#ad4e2f2779bf494a5be76530da23ab413">D_ENERGY</a>  = 0; </div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="d0/dc0/namespacedammIds_1_1dettemplate.html#a5e63f16ba4b5e39f257f4279cee9eacb">DD_TEMPLATE_VS_PULSER</a> = 1; </div><div class="line">    }</div><div class="line">}<span class="comment">//namespace dammIds</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="d8/dcc/namespacestd.html">std</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="d0/dc0/namespacedammIds_1_1dettemplate.html">dammIds::dettemplate</a>;</div><div class="line"></div><div class="line"><a class="code" href="d4/d92/classTemplateProcessor.html#aa17271683f7099ab58dbfa09c891d3b7">TemplateProcessor::TemplateProcessor</a>():</div><div class="line">    <a class="code" href="d2/d58/classEventProcessor.html">EventProcessor</a>(<a class="code" href="d0/dc0/namespacedammIds_1_1dettemplate.html#afd3b8cb53acb43b02c5aaec57653de52">OFFSET</a>, <a class="code" href="d0/dc0/namespacedammIds_1_1dettemplate.html#a29eaf1457a9f1a898ae332726f7cb316">RANGE</a>, <span class="stringliteral">&quot;TemplateProcessor&quot;</span>) {</div><div class="line">    associatedTypes.insert(<span class="stringliteral">&quot;template&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="d4/d92/classTemplateProcessor.html#aa17271683f7099ab58dbfa09c891d3b7">TemplateProcessor::TemplateProcessor</a>(<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;a):</div><div class="line">    <a class="code" href="d2/d58/classEventProcessor.html">EventProcessor</a>(<a class="code" href="d8/dd3/namespacedammIds_1_1raw.html#a0af3314d10f1af8ee7e09ad22635ca10">OFFSET</a>, <a class="code" href="d8/dd3/namespacedammIds_1_1raw.html#a464ff94b3296abf6c08ea705b0919049">RANGE</a>, <span class="stringliteral">&quot;TemplateProcessor&quot;</span>) {</div><div class="line">    associatedTypes.insert(<span class="stringliteral">&quot;template&quot;</span>);</div><div class="line">    a_ = a;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="d4/d92/classTemplateProcessor.html#ae447375c9e3eae31685252bf17e526ad">TemplateProcessor::DeclarePlots</a>(<span class="keywordtype">void</span>) {</div><div class="line">    DeclareHistogram1D(<a class="code" href="de/dcd/namespacedammIds_1_1ge.html#a6a5d3ab083c3f428ddd1148bdd15d4e5">D_ENERGY</a>, <a class="code" href="df/dd7/DammPlotIds_8hpp.html#ae32bacd5d1cf53f3095e01cd00ab43f3">SA</a>, <span class="stringliteral">&quot;Energy&quot;</span>);</div><div class="line">    DeclareHistogram2D(<a class="code" href="d0/dc0/namespacedammIds_1_1dettemplate.html#a5e63f16ba4b5e39f257f4279cee9eacb">DD_TEMPLATE_VS_PULSER</a>, <a class="code" href="df/dd7/DammPlotIds_8hpp.html#ae32bacd5d1cf53f3095e01cd00ab43f3">SA</a>, <a class="code" href="df/dd7/DammPlotIds_8hpp.html#ae32bacd5d1cf53f3095e01cd00ab43f3">SA</a>,</div><div class="line">                       <span class="stringliteral">&quot;Template Energy vs. Pulser Energy&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> <a class="code" href="d4/d92/classTemplateProcessor.html#a554450b2ad914835e6b1b8d13a31b409">TemplateProcessor::PreProcess</a>(<a class="code" href="de/d77/classRawEvent.html">RawEvent</a> &amp;event) {</div><div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="d2/d58/classEventProcessor.html#a472c9d8c540b273ad1ca9a7f380344b6">EventProcessor::PreProcess</a>(event))</div><div class="line">        <span class="keywordflow">return</span>(<span class="keyword">false</span>);</div><div class="line"></div><div class="line">    evts_ = <span class="keyword">event</span>.GetSummary(<span class="stringliteral">&quot;template&quot;</span>)-&gt;GetList();</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span>(vector&lt;ChanEvent*&gt;::const_iterator it = evts_.begin();</div><div class="line">        it != evts_.end(); it++) {</div><div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> location = (*it)-&gt;GetChanID().GetLocation();</div><div class="line">        <span class="keywordflow">if</span>(location == 0)</div><div class="line">            plot(<a class="code" href="de/dcd/namespacedammIds_1_1ge.html#a6a5d3ab083c3f428ddd1148bdd15d4e5">D_ENERGY</a>, (*it)-&gt;GetEnergy()*a_);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span>(<span class="keyword">true</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> <a class="code" href="d4/d92/classTemplateProcessor.html#a75039958a15712e6d1f83b3654ce6e88">TemplateProcessor::Process</a>(<a class="code" href="de/d77/classRawEvent.html">RawEvent</a> &amp;event) {</div><div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="d2/d58/classEventProcessor.html#ae2d41a947da0cb509fd0ca85f6caa0fc">EventProcessor::Process</a>(event))</div><div class="line">        <span class="keywordflow">return</span>(<span class="keyword">false</span>);</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> vector&lt;ChanEvent*&gt; &amp; pulserEvents =</div><div class="line">        <span class="keyword">event</span>.GetSummary(<span class="stringliteral">&quot;pulser&quot;</span>)-&gt;GetList();</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span>(vector&lt;ChanEvent*&gt;::const_iterator it = evts_.begin();</div><div class="line">        it != evts_.end(); it++) {</div><div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> loc = (*it)-&gt;GetChanID().GetLocation();</div><div class="line">        <span class="keywordflow">for</span>(vector&lt;ChanEvent*&gt;::const_iterator itA = pulserEvents.begin();</div><div class="line">            itA != pulserEvents.end(); itA++) {</div><div class="line">            <span class="keywordflow">if</span>(loc == 0)</div><div class="line">                plot(<a class="code" href="d0/dc0/namespacedammIds_1_1dettemplate.html#a5e63f16ba4b5e39f257f4279cee9eacb">DD_TEMPLATE_VS_PULSER</a>, (*it)-&gt;GetEnergy(),</div><div class="line">                     (*itA)-&gt;GetEnergy());</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">return</span>(<span class="keyword">true</span>);</div><div class="line">}</div></div><!-- fragment --><p>Once a class exists for your new detector you must create an instance of it in the <a class="el" href="d4/d4a/classDetectorDriver.html" title="DetectorDriver controls event processing. ">DetectorDriver</a>. Include the proper file in <a class="el" href="d8/dc6/DetectorDriver_8cpp.html" title="Main driver for event processing. ">DetectorDriver.cpp</a> </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="dc/deb/TemplateProcessor_8hpp.html">TemplateProcessor.hpp</a>&quot;</span></div></div><!-- fragment --><p> Be sure that you put the proper detector type into the "associated types" vector in the constructor. This will ensure that whenever this detector type is in the event the processor will be called.</p>
<p>Next initialize it with the other processors in the constructor of <a class="el" href="d4/d4a/classDetectorDriver.html" title="DetectorDriver controls event processing. ">DetectorDriver</a>. </p><div class="fragment"><div class="line">...</div><div class="line">} <span class="keywordflow">else</span> <span class="keywordflow">if</span> (name == <span class="stringliteral">&quot;TemplateProcessor&quot;</span>) {</div><div class="line">        vecProcess.push_back(<span class="keyword">new</span> <a class="code" href="d4/d92/classTemplateProcessor.html">TemplateProcessor</a>());</div><div class="line">}</div><div class="line">...</div></div><!-- fragment --><p>Finally, your new processor simply needs to be added to the Config.xml and you are ready to do your analysis.</p>
<p>Adding a new detector type needs only minimal additional changes to the <a class="el" href="d1/dfd/classDetectorLibrary.html" title="A class to define a library of detectors known to the analysis. ">DetectorLibrary</a>. To the list of known detectors </p><div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> detTypes = 2;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">string</span> detectorStrings[detTypes] = {</div><div class="line">    <span class="stringliteral">&quot;3hen&quot;</span>, <span class="stringliteral">&quot;beta_scint&quot;</span>, <span class="stringliteral">&quot;dssd_front&quot;</span>, <span class="stringliteral">&quot;dssd_back&quot;</span>, <span class="stringliteral">&quot;ge&quot;</span>, <span class="stringliteral">&quot;generic&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;idssd_front&quot;</span>, <span class="stringliteral">&quot;ignore&quot;</span>, <span class="stringliteral">&quot;ion_chamber&quot;</span>, <span class="stringliteral">&quot;liquid_scint&quot;</span>, <span class="stringliteral">&quot;logic&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;mcp&quot;</span>, <span class="stringliteral">&quot;mtc&quot;</span>, <span class="stringliteral">&quot;neutron_scint&quot;</span>, <span class="stringliteral">&quot;position&quot;</span>, <span class="stringliteral">&quot;pulser&quot;</span>, <span class="stringliteral">&quot;si&quot;</span>, <span class="stringliteral">&quot;ssd&quot;</span>,</div><div class="line">    <span class="stringliteral">&quot;timeclass&quot;</span>, <span class="stringliteral">&quot;tvandle&quot;</span>, <span class="stringliteral">&quot;vandle&quot;</span>, <span class="stringliteral">&quot;template&quot;</span></div><div class="line">};</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Pixie16 Analysis Software</a></li><li class="navelem"><a class="el" href="devman.html">Developer Manual (under construction)</a></li>
    <li class="footer">Generated on Sun Jun 5 2016 08:08:20 for Pixie16 Analysis Software Suite by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
